<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>اختبار الجهاز المركزي للتنظيم والإدارة</title>
    <style>
      body {
        font-family: "Tahoma", sans-serif;
        text-align: center;
        background: #f7f7f7;
        direction: rtl;
        margin: 0;
        padding: 0;
      }
      .screen {
        display: none;
        padding: 30px;
      }
      .active {
        display: block;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        border-radius: 8px;
      }
      button[disabled] {
        opacity: 0.45;
        cursor: not-allowed;
      }
      .countdown {
        font-size: 22px;
        color: #333;
        margin-bottom: 20px;
      }
      ul {
        list-style: none;
        padding: 0;
      }
      li {
        margin: 10px 0;
        font-size: 18px;
      }
      .lang-row {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin-top: 18px;
      }
    </style>
  </head>
  <body>
    <!-- شاشة الترحيب -->
    <section id="welcome" class="screen active">
      <h2>
        نفيدكم علمًا بأنكم على وشك البدء في اختبار الجهاز المركزي للتنظيم
        والإدارة
      </h2>
      <button onclick="showSection('axes')">متابعة</button>
    </section>

    <!-- شاشة عرض المحاور -->
    <section id="axes" class="screen">
      <h2>محاور الاختبار</h2>
      <ul>
        <li>1️⃣ محور الجدارات السلوكية</li>
        <li>2️⃣ محور الكفايات اللغوية (عربي + إنجليزي)</li>
        <li>3️⃣ محور الكفاية المعرفية (معلومات عامة)</li>
        <li>4️⃣ محور الكفايات التكنولوجية (حاسب آلي)</li>
        <li>5️⃣ محور الكفايات التربوية (تربوي)</li>
        <li>6️⃣ محور كفايات التخصص</li>
      </ul>
      <button onclick="startExam()">ابدأ أول محور</button>
    </section>

    <!-- شاشة اختيار اللغة -->
    <section id="languageSelect" class="screen">
      <h2 id="langTitle">اختر اللغة</h2>
      <div class="lang-row">
        <button id="btn-ar" onclick="chooseLanguage('ar')">عربي</button>
        <button id="btn-en" onclick="chooseLanguage('en')">إنجليزي</button>
      </div>
    </section>

    <!-- شاشة الاختبار -->
    <section id="examScreen" class="screen">
      <h2 id="examTitle"></h2>
      <div id="questionContainer"></div>
      <button id="nextBtn" onclick="nextQuestion()">التالي</button>
    </section>

    <!-- شاشة الاستراحة -->
    <section id="breakScreen" class="screen">
      <h2 id="nextAxisTitle">استعد للمحور القادم</h2>
      <div class="countdown">يبدأ خلال <span id="countdown">5</span> ثوانٍ</div>
      <button onclick="skipBreak()">ابدأ الآن</button>
    </section>

    <!-- شاشة النهاية -->
    <section id="endScreen" class="screen">
      <h2>انتهيت من جميع المحاور ✅</h2>
      <button onclick="location.reload()">تسجيل الخروج</button>
    </section>

    <script>
      const screens = document.querySelectorAll(".screen");
      const axes = [
        { key: "behavioral", label: "الجدارات السلوكية" },
        { key: "linguistic", label: "الكفايات اللغوية" },
        { key: "cognitive", label: "الكفاية المعرفية" },
        { key: "tech", label: "الكفايات التكنولوجية" },
        { key: "pedagogic", label: "الكفايات التربوية" },
        { key: "specialization", label: "كفايات التخصص" },
      ];

      // sample questions
      const QUESTIONS = {
        behavioral: [{ q: "السؤال السلوكي 1", a: ["أ", "ب"], c: 0 }],
        linguistic_ar: [{ q: "سؤال لغوي عربي 1", a: ["أ", "ب"], c: 0 }],
        linguistic_en: [{ q: "English linguistic Q1", a: ["A", "B"], c: 0 }],
        cognitive: [{ q: "سؤال معرفي 1", a: ["أ", "ب"], c: 0 }],
        tech_ar: [{ q: "سؤال حاسب عربي 1", a: ["أ", "ب"], c: 0 }],
        tech_en: [{ q: "Computer Q1", a: ["Yes", "No"], c: 0 }],
        pedagogic: [{ q: "سؤال تربوي 1", a: ["أ", "ب"], c: 0 }],
        specialization: [{ q: "سؤال تخصص 1", a: ["أ", "ب"], c: 0 }],
      };

      let currentAxisIndex = 0;
      let currentLang = null; // 'ar' or 'en'
      let axisLangDone = {
        linguistic: { ar: false, en: false },
        tech: { ar: false, en: false },
      }; // track per-axis per-lang
      let axisDone = {}; // axis.key => true when fully done
      let currentQuestions = [];
      let currentQuestionIndex = 0;

      function showSection(id) {
        screens.forEach((s) => s.classList.remove("active"));
        document.getElementById(id).classList.add("active");
      }

      function startExam() {
        currentAxisIndex = 0;
        startAxis();
      }

      function startAxis() {
        const axis = axes[currentAxisIndex];
        if (!axis) return showSection("endScreen");

        // if axis already done (shouldn't happen in normal flow) skip
        if (axisDone[axis.key]) {
          currentAxisIndex++;
          return startAxis();
        }

        // linguistic special flow: require both languages, enable only not-done languages
        if (axis.key === "linguistic") {
          setupLanguageSelectForAxis("linguistic");
          return;
        }

        // tech special flow: choose one language, after finishing it, consider axis done (do not return to lang select)
        if (axis.key === "tech") {
          setupLanguageSelectForAxis("tech");
          return;
        }

        // default axes: load questions and show
        loadQuestionsForAxis(axis.key);
        showSection("examScreen");
      }

      function setupLanguageSelectForAxis(axisKey) {
        currentLang = null;
        // update title
        document.getElementById("langTitle").textContent =
          "اختر اللغة - " + axes[currentAxisIndex].label;
        // enable/disable buttons based on axisLangDone
        const btnAr = document.getElementById("btn-ar");
        const btnEn = document.getElementById("btn-en");

        if (axisKey === "linguistic") {
          btnAr.disabled = axisLangDone.linguistic.ar;
          btnEn.disabled = axisLangDone.linguistic.en;
        } else if (axisKey === "tech") {
          // for tech: allow either language only if axis not done
          const doneBoth = axisLangDone.tech.ar || axisLangDone.tech.en; // if one done, treat axis as done
          btnAr.disabled = doneBoth;
          btnEn.disabled = doneBoth;
        }

        showSection("languageSelect");
      }

      function chooseLanguage(lang) {
        const axis = axes[currentAxisIndex];
        currentLang = lang;
        // prepare question key
        const qKey =
          axis.key === "linguistic"
            ? `linguistic_${lang}`
            : axis.key === "tech"
            ? `tech_${lang}`
            : `${axis.key}_${lang}`;
        // for tech and linguistic we built keys accordingly
        // load questions
        loadQuestionsForAxis(qKey);
        showSection("examScreen");
      }

      function loadQuestionsForAxis(key) {
        // key for QUESTIONS: for normal axes use axis.key, for language axes use linguistic_ar etc.
        currentQuestions =
          QUESTIONS[key] || QUESTIONS[axes[currentAxisIndex].key] || [];
        currentQuestionIndex = 0;
        renderQuestion();
        // set exam title
        const axis = axes[currentAxisIndex];
        let title = axis.label;
        if (currentLang)
          title += " - " + (currentLang === "ar" ? "عربي" : "English");
        document.getElementById("examTitle").textContent = title;
      }

      function renderQuestion() {
        const container = document.getElementById("questionContainer");
        if (!currentQuestions.length) {
          container.innerHTML = "<p>لا توجد أسئلة لهذا المحور.</p>";
          return;
        }
        const q = currentQuestions[currentQuestionIndex];
        container.innerHTML =
          `<p>${q.q}</p>` +
          q.a
            .map(
              (ans, i) =>
                `<div><label><input name='ans' type='radio'/> ${ans}</label></div>`
            )
            .join("");
      }

      function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < currentQuestions.length) {
          renderQuestion();
          return;
        }
        // finished current language/axis
        finishCurrent();
      }

      function finishCurrent() {
        const axis = axes[currentAxisIndex];
        // if linguistic: mark this language done; if both done -> axis done and move next; else go back to lang select with remaining enabled
        if (axis.key === "linguistic") {
          axisLangDone.linguistic[currentLang] = true;
          // disable the language just finished (so user can't retake it)
          // if both done -> mark axis done -> proceed to break/next
          if (axisLangDone.linguistic.ar && axisLangDone.linguistic.en) {
            axisDone["linguistic"] = true;
            currentLang = null;
            currentAxisIndex++;
            startBreak();
          } else {
            currentLang = null;
            setupLanguageSelectForAxis("linguistic");
          }
          return;
        }

        // if tech: mark chosen language done and mark axis as fully done (user won't be returned to select other language)
        if (axis.key === "tech") {
          axisLangDone.tech[currentLang] = true;
          axisDone["tech"] = true;
          currentLang = null;
          currentAxisIndex++;
          startBreak();
          return;
        }

        // default axes
        axisDone[axis.key] = true;
        currentAxisIndex++;
        startBreak();
      }

      function startBreak() {
        if (currentAxisIndex >= axes.length) return showSection("endScreen");
        document.getElementById(
          "nextAxisTitle"
        ).textContent = `استعد للمحور القادم: ${axes[currentAxisIndex].label}`;
        let count = 5;
        document.getElementById("countdown").textContent = count;
        showSection("breakScreen");
        const interval = setInterval(() => {
          count--;
          document.getElementById("countdown").textContent = count;
          if (count <= 0) {
            clearInterval(interval);
            startAxis();
          }
        }, 1000);
        window.skipBreak = function () {
          clearInterval(interval);
          startAxis();
        };
      }

      // start functions for buttons
      window.showSection = showSection;
      window.startExam = startExam;
      window.skipBreak = skipBreak;
    </script>
  </body>
</html>
